{"ts":1349302195602,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<!DOCTYPE html>\n<html>\n<head>\n    <title>scopechange</title>\n\n    <script type=\"text/javascript\" src=\"/apps/2.0p4/sdk.js\"></script>\n\n    <script type=\"text/javascript\">\n        Rally.onReady(function() {\n            Ext.define('ScopeChange', {\n                extend: 'Rally.app.App',\n                layout: { type: 'vbox', align: 'stretch' },\n                appName:'ScopeChanges',\n                componentCls: 'app',\n            \n            //    _filters:undefined,\n            //    _types:['User Story', 'Defect'],\n            \n                 items:[\n                    {\n                        xtype: 'panel',\n                        layout: 'anchor',\n                        border: true,\n                        fieldDefaults: {\n                            labelWidth: 40\n                        },\n                        defaultType: 'textfield',\n                        bodyPadding: 5,\n                        items: [\n                            {\n                                fieldLabel: 'Query',\n                                itemId: 'queryField',\n                                anchor:'100%',\n                                width: 700,\n                                height: 100,\n                                xtype: 'textarea',\n                                value: '{\\n'+\n                                        ' \"ObjectID\": {$gt:0},\\n'+\n                                        ' \"__At\": \"current\"\\n'+\n                                        '}'\n                            },\n                            {\n                                fieldLabel: 'Fields',\n                                itemId: 'fieldsField',\n                                anchor: '100%',\n                                width: 700,\n                                value: \"ObjectID, _ValidFrom, _UnformattedID, Name\"\n                            },\n                            {\n                                fieldLabel: 'Sort',\n                                itemId: 'sortField',\n                                anchor: '100%',\n                                width: 700,\n                                value: \"{'ObjectID' : -1, '_ValidFrom': 1}\"\n                            },\n                            {\n                                fieldLabel: 'Page Size',\n                                itemId: 'pageSizeField',\n                                anchor: '100%',\n                                width: 700,\n                                value: '10'\n                            }\n                        ],\n                        \n                        buttons: [\n                            {\n                                xtype: 'rallybutton',\n                                text: 'Search',\n                                itemId: 'searchButton'\n                            }\n                        ]\n                    },\n                    {\n                        xtype: 'panel',\n                        itemId: 'gridHolder',\n                        layout: 'fit',\n                        height: 400\n                    }\n                ],\n                \n                launch: function() {\n                    var button = this.down('#searchButton');\n                    button.on('click', this.searchClicked, this);\n                },\n                \n                searchClicked: function(){\n                    var queryField = this.down('#queryField');\n                    var query = queryField.getValue();\n                    var selectedFields = this.down('#fieldsField').getValue();\n                    if(selectedFields){\n                        if(selectedFields === 'true'){\n                            selectedFields = true;\n                        }\n                        else{\n                            selectedFields = selectedFields.split(', ');\n                        }\n                    }\n                    \n                    var sort = this.down('#sortField').getValue();\n                    \n                    var pageSize = this.down('#pageSizeField').getValue();\n                    var parsedPageSize = parseInt(pageSize, 10);\n                    // don't allow empty or 0 pagesize\n                    pageSize = (parsedPageSize) ? parsedPageSize : 10;\n            \n                    var callback = Ext.bind(this.processSnapshots, this);\n                    this.doSearch(query, selectedFields, sort, pageSize, callback);\n                },\n                \n                createSortMap: function(csvFields){\n                    var fields = csvFields.split(', ');\n                    var sortMap = {};\n                    for(var field in fields){\n                        if(fields.hasOwnProperty(field)){\n                            sortMap[field] = 1;\n                        }\n                    }\n                    \n                    return sortMap;\n                },\n                \n                doSearch: function(query, fields, sort, pageSize, callback){\n                    var transformStore = Ext.create('Rally.data.lookback.SnapshotStore', {\n                        context: {\n                            workspace: this.context.getWorkspace(),\n                            project: this.context.getProject()\n                        },\n                        fetch: fields,\n                        rawFind: query,\n                        autoLoad: true,\n                        listeners: {\n                            scope: this,\n                            load: this.processSnapshots\n                        }\n                    });\n                },\n                \n                processSnapshots: function(store, records){\n                    var snapshotGrid = Ext.create('Rally.ui.grid.Grid', {\n                        title: 'Snapshots',\n                        store: store,\n                        columnCfgs: [\n                            {\n                                text: 'ObjectID',\n                                dataIndex: 'ObjectID'\n                            },\n                            {\n                                text: 'Name',\n                                dataIndex: 'Name'\n                            },\n                            {\n                                text: 'Project',\n                                dataIndex: 'Project'\n                            },\n                            {\n                                text: '_ValidFrom',\n                                dataIndex: '_ValidFrom'\n                            },\n                            {\n                                text: '_ValidTo',\n                                dataIndex: '_ValidTo'\n                            }\n                        ],\n                        height: 400\n                    });\n                    \n                    var gridHolder = this.down('#gridHolder');\n                    gridHolder.removeAll(true);\n                    gridHolder.add(snapshotGrid);\n                }\n            });\n\n            Rally.launchApp('ScopeChange', {\n                name: 'scopechange'\n            });\n        });\n    </script>\n\n    <style type=\"text/css\">\n        .app {\n             /* Add app styles here */\n        }\n    </style>\n</head>\n<body></body>\n</html>\n"]],"start1":0,"start2":0,"length1":0,"length2":7217}]],"length":7217}
